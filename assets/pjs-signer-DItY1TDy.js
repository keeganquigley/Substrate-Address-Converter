import{w as ie,x as G,y as F,z as D,C as j,F as J,D as B,A as N,S as c,O as S,V as y,M as g,K as V,_ as v,N as $,H as A,T as q,E as te}from"./index-ChSEz4ri.js";const ae=new TextEncoder().encode("SS58PRE"),K=2,ve=e=>{try{const t=ie.decode(e),n=t.subarray(0,t[0]&64?2:1),i=t.subarray(n.length,t.length-K),r=t.subarray(n.length+i.length),p=G(Uint8Array.of(...ae,...n,...i),{dkLen:64}).subarray(0,K);return r[0]===p[0]&&r[1]===p[1]?{isValid:!0,ss58Format:ge(n),publicKey:i.slice()}:{isValid:!1}}catch{return{isValid:!1}}},ge=e=>{const t=new DataView(e.buffer,e.byteOffset,e.byteLength);return t.byteLength===1?t.getUint8(0):t.getUint16(0)},fe=e=>{let t={},n=0,i=0;const r=()=>{n===i?(t={},n=i=0):(i=n,setTimeout(r,0))};return p=>{var a,u;++n===1&&r();let m=t;const T=p.length-1;for(let l=0;l<=T;l++)m=m[a=p[l]]||(m[a]={});return m[u=p[T]]||(m[u]=e(p))}},he=e=>{const t=e<64?Uint8Array.of(e):Uint8Array.of((e&252)>>2|64,e>>8|(e&3)<<6);return fe(n=>{const i=G(Uint8Array.of(...ae,...t,...n),{dkLen:64}).subarray(0,K);return ie.encode(Uint8Array.of(...t,...n,...i))})};function me(e,t){return n=>{const i=ve(n);if(!i.isValid)throw new Error("Invalid checksum");const{publicKey:r}=i;if(r.length!==e)throw new Error("Invalid public key length");return r}}const xe=(e=42,t=32)=>F(D(t),me(t),he(e)),o=F(j,e=>e,Number),we=F(j,e=>e,BigInt),le=e=>{const t=D.enc(e);return n=>t(N(n))},ue=e=>{const t=D.dec(e);return n=>B(t(n))},O=e=>J(le(e),ue(e));O.enc=le;O.dec=ue;const L=(e,t)=>{const n=e;return n.inner=t,n},X=e=>L(c(e),e);X.enc=e=>L(c.enc(e),e);X.dec=e=>L(c.dec(e),e);const Y=e=>L(S(e),e);Y.enc=e=>L(S.enc(e),e);Y.dec=e=>L(S.dec(e),e);const E=y(g),ne=S(g),be=V({bool:v,char:v,str:v,u8:v,u16:v,u32:v,u64:v,u128:v,u256:v,i8:v,i16:v,i32:v,i64:v,i128:v,i256:v}),pe=y(c({name:ne,type:o,typeName:ne,docs:E})),ke=c({len:$,type:o}),Ee=c({bitStoreType:o,bitOrderType:o}),Se=y(c({name:g,fields:pe,index:A,docs:E})),Te=V({composite:pe,variant:Se,sequence:o,array:ke,tuple:y(o),primitive:be,compact:o,bitSequence:Ee}),Ie=c({name:g,type:S(o)}),Ae=y(Ie),Ce=c({id:o,path:E,params:Ae,def:Te,docs:E}),Q=y(Ce),_=V({NotDeprecated:v,DeprecatedWithoutNote:v,Deprecated:c({note:g,since:S(g)})}),Be=y(c({index:A,deprecation:V({DeprecatedWithoutNote:v,Deprecated:c({note:g,since:S(g)})},[1,2])})),Z={name:g,inputs:y(c({name:g,type:o})),output:o,docs:E},Oe=c({name:g,methods:y(c(Z)),docs:E}),Pe=c({name:g,methods:y(c({...Z,deprecationInfo:_})),docs:E,version:o,deprecationInfo:_}),Ve=c({id:O(32),...Z,deprecationInfo:_}),_e=V({Blake2128:v,Blake2256:v,Blake2128Concat:v,Twox128:v,Twox256:v,Twox64Concat:v,Identity:v}),je=y(_e),Le=c({hashers:je,key:o,value:o}),de={name:g,modifier:A,type:V({plain:o,map:Le}),fallback:O(),docs:E},R=S(o),ye={name:g,storage:S(c({prefix:g,items:y(c(de))})),calls:R,events:R,constants:y(c({name:g,type:o,value:O(),docs:E})),errors:R,index:A},Me={...ye,docs:E},W=S(c({type:o,deprecationInfo:Be})),Ue={name:g,storage:S(c({prefix:g,items:y(c({...de,deprecationInfo:_}))})),calls:W,events:W,constants:y(c({name:g,type:o,value:O(),docs:E,deprecationInfo:_})),errors:W,associatedTypes:y(c({name:g,type:o,docs:E})),viewFns:y(Ve),index:A,docs:E,deprecationInfo:_},Ne=new Uint8Array,se=e=>J(()=>Ne,()=>e),De=c({type:o,version:A,signedExtensions:y(c({identifier:g,type:o,additionalSigned:o}))}),He=c({lookup:Q,pallets:y(c({...ye,docs:se([])})),extrinsic:De,type:o,apis:se([])}),Fe=c({version:A,address:o,call:o,signature:o,extra:o,signedExtensions:y(c({identifier:g,type:o,additionalSigned:o}))}),$e=c({lookup:Q,pallets:y(c(Me)),extrinsic:Fe,type:o,apis:y(Oe),outerEnums:c({call:o,event:o,error:o}),custom:y(q(g,c({type:o,value:O()})))}),qe=c({version:y(A),address:o,call:o,signature:o,signedExtensionsByVersion:y(q(A,y(o))),signedExtensions:y(c({identifier:g,type:o,additionalSigned:o}))}),Re=c({lookup:Q,pallets:y(c(Ue)),extrinsic:qe,apis:y(Pe),outerEnums:c({call:o,event:o,error:o}),custom:y(q(g,c({type:o,value:O()})))}),re=()=>{throw new Error("Unsupported metadata version!")},b=J(re,re),H=c({magicNumber:$,metadata:V({v0:b,v1:b,v2:b,v3:b,v4:b,v5:b,v6:b,v7:b,v8:b,v9:b,v10:b,v11:b,v12:b,v13:b,v14:He,v15:$e,v16:Re})}),ee=D(),We=S(ee),ze=q(j,ee),Ke=e=>{try{return H.dec(e)}catch{}try{return H.dec(We.dec(e))}catch{}try{return H.dec(ee.dec(e))}catch{}try{return H.dec(ze.dec(e)[1])}catch{}throw null},Ge=e=>{if("magicNumber"in e&&(e=e.metadata),"tag"in e){if(e.tag!=="v14"&&e.tag!=="v15"&&e.tag!=="v16")throw new Error("Only metadata 14, 15, and 16 are supported");e=e.value}if("signedExtensionsByVersion"in e.extrinsic)return{version:16,...e};if("custom"in e){const{lookup:r,extrinsic:p,custom:a,apis:u,pallets:m,outerEnums:T}=e;return{version:15,lookup:r,pallets:m.map(l=>({...l,calls:l.calls!=null?{type:l.calls}:void 0,events:l.events!=null?{type:l.events}:void 0,errors:l.errors!=null?{type:l.errors}:void 0,viewFns:[],associatedTypes:[]})),extrinsic:{...p,version:[p.version]},apis:u,outerEnums:T,custom:a}}const{lookup:t,extrinsic:n,pallets:i}=e;return{version:14,lookup:t,pallets:i.map(r=>({...r,calls:r.calls!=null?{type:r.calls}:void 0,events:r.events!=null?{type:r.events}:void 0,errors:r.errors!=null?{type:r.errors}:void 0,viewFns:[],associatedTypes:[]})),extrinsic:{...n,version:[n.version]},apis:[]}},P={bare:0,0:"bare",general:1,1:"general",signed:2,2:"signed"},Je=F(A,({version:e,type:t})=>e+(P[t]<<6),e=>{const t=e&63,n=e>>6;if(t===4&&(n===P.bare||n===P.signed))return{version:t,type:P[n]};if(t===5&&(n===P.bare||n===P.general))return{version:t,type:P[n]};throw new Error(`ExtrinsicFormat ${e} not valid`)}),Xe={dkLen:32},Ye=e=>G(e,Xe),oe=(e,t)=>e.type==="array"&&e.len===t&&e.value.type==="primitive"&&e.value.value==="u8",C={type:"void"},Qe=(e,t=()=>null)=>{const n=new Map,i=new Set,r=l=>d=>{let s=n.get(d);if(s)return s;if(i.has(d)){const x={id:d};return n.set(d,x),x}i.add(d);const w=l(d);return s=n.get(d),s?Object.assign(s,w):(s={id:d,...w},n.set(d,s)),i.delete(d),s};let p=!0,a=!0;const u=r(l=>{const d=t(e[l]);if(d)return d;const{def:s,path:w,params:x}=e[l];if(s.tag==="composite"){if(s.value.length===0)return C;if(s.value.length===1){const f=u(s.value[0].type);return p&&w.at(-1)==="AccountId32"&&oe(f,32)?(p=!1,{type:"AccountId32"}):a&&w.at(-1)==="AccountId20"&&oe(f,20)?(a=!1,{type:"AccountId20"}):f}return m(s.value)}if(s.tag==="variant"){if(w.length===1&&w[0]==="Option"&&x.length===1&&x[0].name==="T"){const h=u(x[0].type);return h.type==="void"?{type:"primitive",value:"bool"}:{type:"option",value:h}}if(w.length===1&&w[0]==="Result"&&x.length===2&&x[0].name==="T"&&x[1].name==="E")return{type:"result",value:{ok:u(x[0].type),ko:u(x[1].type)}};if(s.value.length===0)return C;const f={},k={};return s.value.forEach(h=>{const I=h.name;if(k[I]=h.docs,h.fields.length===0){f[I]={...C,idx:h.index};return}if(h.fields.length===1&&!h.fields[0].name){f[I]={type:"lookupEntry",value:u(h.fields[0].type),idx:h.index};return}f[I]={...m(h.fields),idx:h.index}}),{type:"enum",value:f,innerDocs:k}}if(s.tag==="sequence")return{type:"sequence",value:u(s.value)};if(s.tag==="array"){const{len:f}=s.value,k=u(s.value.type);return!f||k.type==="void"?C:f>1?{type:"array",value:k,len:s.value.len}:k}if(s.tag==="tuple")return s.value.length===0?C:s.value.length>1?T(s.value.map(f=>u(f)),s.value.map(f=>e[f].docs)):u(s.value[0]);if(s.tag==="primitive")return{type:"primitive",value:s.value.tag};if(s.tag==="compact"){const f=u(s.value);return f.type==="void"?C:{type:"compact",isBig:Number(f.value.slice(1))>32,size:f.value}}return{type:s.tag,isLSB:(e[s.value.bitOrderType].path.at(-1)??"LSB").toUpperCase().startsWith("LSB")}}),m=l=>{let d=!0;const s={},w={};return l.forEach((x,f)=>{d=d&&!!x.name;const k=x.name||f,h=u(x.type);h.type!=="void"&&(s[k]=h,w[k]=x.docs)}),d?{type:"struct",value:s,innerDocs:w}:T(Object.values(s),Object.values(w))},T=(l,d)=>{if(l.every(s=>s.id===l[0].id)&&d.every(s=>!s.length)){const[s]=l;return s.type==="void"?C:{type:"array",value:l[0],len:l.length}}return{type:"tuple",value:l,innerDocs:d}};return u},Ze=e=>{const t=Qe(e.lookup,({def:r})=>{if(r.tag==="composite"){const p=n(r);if(p)return{type:"enum",innerDocs:{},value:Object.fromEntries(e.pallets.map(a=>[a.name,a.errors==null?{...C,idx:a.index}:{type:"lookupEntry",value:t(a.errors.type),idx:a.index}])),byteLength:p}}return null});function n(r){if(!(r.value.length===2&&r.value[0].name==="index"&&r.value[1].name==="error"))return null;const a=t(r.value[0].type),u=t(r.value[1].type);return a.type==="primitive"&&a.value==="u8"&&u.type==="array"&&u.value.type==="primitive"&&u.value.value==="u8"?1+u.len:null}return Object.assign(t,{metadata:e,call:"call"in e.extrinsic?e.extrinsic.call:e.lookup[e.extrinsic.type]?.params.find(a=>a.name==="Call")?.type??null})},z=()=>new Error("Unkown signer"),et=e=>{const{extrinsic:t}=e,n=Ze(e);let i,r;if("address"in t)i=n(t.address),r=n(t.signature);else{const p=Object.fromEntries(e.lookup[t.type].params.filter(a=>a.type!=null).map(a=>[a.name,n(a.type)]));if(i=p.Address,r=p.Signature,!i||!r)throw z()}if(i.type==="AccountId20"&&r.type==="array"&&r.len===65&&r.value.type==="primitive"&&r.value.value==="u8")return[1,[]];if(r.type!=="enum"||["Ecdsa","Ed25519","Sr25519"].some(p=>!(p in r.value)))throw z();if(i.type==="enum"){const p=i.value.Id;if(p.type==="lookupEntry"&&p.value.type==="AccountId32")return[0,[p.idx]]}else if(i.type==="AccountId32")return[0,[]];throw z()},tt=(e,t,n,i,r,p)=>{const[a,u]=et(e),m=te([Je.enc({version:4,type:"signed"}),a===1?t:new Uint8Array([...u,...t]),n,...i,r]);return te([j.enc(m.length),m])},M=(e,t)=>{let n=e.toString(16);n=(n.length%2?"0":"")+n;const i=Math.max(0,(t||0)-n.length/2);return"0x"+"00".repeat(i)+n},nt=({additionalSigned:e})=>({genesisHash:B(e)}),st=({value:e})=>({nonce:M(j.dec(e),4)}),rt=({additionalSigned:e})=>({transactionVersion:M($.dec(e),4)}),ot=X({tip:j,asset:Y(D(1/0))}).dec,ct=({value:e})=>{const{tip:t,asset:n}=ot(e);return{...n?{assetId:B(n)}:{},tip:M(t,16)}},it=({value:e})=>({tip:M(we.dec(e),16)}),at=({value:e,additionalSigned:t},n)=>({era:B(e),blockHash:B(t),blockNumber:M(n,4)}),lt=({additionalSigned:e})=>({specVersion:M($.dec(e),4)}),ut=({value:e,additionalSigned:t})=>e.length&&e[0]?{mode:1,metadataHash:B(t.length?t.slice(1):t)}:{},ce=Object.freeze(Object.defineProperty({__proto__:null,ChargeAssetTxPayment:ct,ChargeTransactionPayment:it,CheckGenesis:nt,CheckMetadataHash:ut,CheckMortality:at,CheckNonce:st,CheckSpecVersion:lt,CheckTxVersion:rt},Symbol.toStringTag,{value:"Module"})),pt=xe().enc,dt=e=>e.startsWith("0x")?N(e):pt(e);function yt(e,t,n){const i=a=>n({address:e,data:B(a),type:"bytes"}).then(({signature:u})=>N(u)),r=dt(e);return{publicKey:r,signTx:async(a,u,m,T,l=Ye)=>{const d=Ge(Ke(m)),s={};s.signedExtensions=[];const{version:w}=d.extrinsic,x=[];d.extrinsic.signedExtensions.map(({identifier:I})=>{const U=u[I];if(!U)throw new Error(`Missing ${I} signed-extension`);if(x.push(U.value),s.signedExtensions.push(I),!ce[I]){if(U.value.length===0&&U.additionalSigned.length===0)return;throw new Error(`PJS does not support this signed-extension: ${I}`)}Object.assign(s,ce[I](U,T))});const f=w.includes(4)?4:null;if(f==null)throw new Error("Only extrinsic v4 is supported");s.address=e,s.method=B(a),s.version=f,s.withSignedTransaction=!0;const k=await t(s),h=k.signedTransaction;return h?typeof h=="string"?N(h):h:tt(d,r,N(k.signature),x,a)},signBytes:i}}const vt=new Set(["ed25519","sr25519","ecdsa","ethereum"]),ft=async(e,t)=>{let n=window.injectedWeb3?.[e];if(!n)throw new Error(`Unavailable extension: "${e}"`);const i=await n.enable(t),r=i.signer.signPayload.bind(i.signer),p=i.signer.signRaw.bind(i.signer),a=l=>l.filter(({type:d})=>vt.has(d)).map(d=>{const s=yt(d.address,r,p);return{...d,polkadotSigner:s}});let u=a(await i.accounts.get());const m=new Set,T=i.accounts.subscribe(l=>{u=a(l),m.forEach(d=>{d(u)})});return{name:e,getAccounts:()=>u,subscribe:l=>(m.add(l),()=>{m.delete(l)}),disconnect:()=>{T()}}},ht=()=>{const{injectedWeb3:e}=window;return e?Object.keys(e):[]};export{ft as connectInjectedExtension,ht as getInjectedExtensions,yt as getPolkadotSignerFromPjs};
